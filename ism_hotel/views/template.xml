<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="website_sale.header_cart_link" name="Header Cart Link">
        <t t-nocache="The number of products is dynamic, this rendering cannot be cached."
           t-nocache-_icon="_icon"
           t-nocache-_text="_text"
           t-nocache-_badge="_badge"
           t-nocache-_badge_class="_badge_class"
           t-nocache-_icon_wrap_class="_icon_wrap_class"
           t-nocache-_text_class="_text_class"
           t-nocache-_item_class="_item_class"
           t-nocache-_link_class="_link_class">
            <t t-set="website_sale_cart_quantity"
               t-value="request.session['website_sale_cart_quantity'] if 'website_sale_cart_quantity' in request.session else website.sale_get_order().cart_quantity or 0"/>
            <t t-set="show_cart" t-value="true"/>
            <li t-attf-class="#{_item_class} divider d-none"/> <!-- Make sure the cart and related menus are not folded (see autohideMenu) -->
            <li t-attf-class="o_wsale_my_cart #{not show_cart and 'd-none'} #{_item_class}">
                <a href="/shop/cart" t-attf-class="#{_link_class}" aria-label="eCommerce cart">
                    <div t-attf-class="#{_icon_wrap_class}">
                        <i t-if="_icon" class="fa fa-shopping-cart fa-stack"/>
                        <sup t-attf-class="my_cart_quantity badge text-bg-primary #{_badge_class} #{'d-none' if (website_sale_cart_quantity == 0) else ''}"
                             t-esc="website_sale_cart_quantity"
                             t-att-data-order-id="request.session.get('sale_order_id', '')"/>
                    </div>
                    <span t-if="_text" t-attf-class="#{_text_class}">My Cart</span>
                </a>
            </li>
        </t>
    </template>
    <template id="website_sale.cart_lines" name="Shopping Cart Lines">
        <div t-if="not website_sale_order or not website_sale_order.website_order_line"
             class="js_cart_lines alert alert-info">
            Your cart is empty!
        </div>
        <t t-if='website_sale_order'>
            <div t-if='website_sale_order._get_shop_warning(clear=False)' class="alert alert-warning js_cart_lines"
                 role="alert">
                <strong>Warning!</strong>
                <t t-esc='website_sale_order._get_shop_warning()'/>
            </div>
        </t>


        <div id="cart_products"
             t-if="website_sale_order and website_sale_order.website_order_line"
             class="js_cart_lines d-flex flex-column mb32">
            <t t-set="show_qty" t-value="is_view_active('website_sale.product_quantity')"/>
            <div t-foreach="website_sale_order.website_order_line"
                 t-as="line"
                 t-attf-class="o_cart_product d-flex align-items-stretch gap-3 #{line.linked_line_id and 'optional_product info'} #{not line_last and 'border-bottom pb-4'} #{line_index &gt; 0 and 'pt-4'}"
                 t-attf-data-product-id="#{line.product_id and line.product_id.id}">
                <t t-if="line.product_id">
                    <img t-if="line._is_not_sellable_line() and line.product_id.image_128"
                         t-att-src="image_data_uri(line.product_id.image_128)"
                         class="o_image_64_max  img rounded"
                         t-att-alt="line.name_short"/>
                    <div t-else=""
                         t-field="line.product_id.image_128"
                         t-options="{'widget': 'image', 'qweb_img_responsive': False, 'class': 'o_image_64_max rounded'}"/>
                    <div class="flex-grow-1">
                        <t t-call="website_sale.cart_line_product_link">
                            <h6 t-field="line.name_short" class="d-inline align-top h6 fw-bold"/>
                        </t>
                        <t t-call="website_sale.cart_line_description_following_lines">
                            <t t-set="div_class" t-valuef="d-none d-md-block"/>
                        </t>
                        <div>
                            <a href='#'
                               class="js_delete_product d-none d-md-inline-block small"
                               aria-label="Remove from cart"
                               title="Remove from cart">Remove
                            </a>
                            <button class="js_delete_product btn btn-light d-inline-block d-md-none"
                                    title="remove">
                                <i class="fa fa-trash-o"/>
                            </button>
                        </div>
                    </div>
                    Ckeck in:
                    <input type="date" readonly="readonly" name="line.product_id.start_in"
                           t-att-value="line.product_id.start_in"/>
                    <br></br>
                    Ckek out:
                    <input type="date" readonly="readonly" name="line.product_id.start_out"
                           t-att-value="line.product_id.start_out"/>
                    <div class="d-flex flex-column align-items-end">
                        <div t-attf-class="css_quantity input-group mb-2"
                             name="website_sale_cart_line_quantity">
                            <t t-if="not line._is_not_sellable_line()">
                                <t t-if="show_qty">
                                    <!--                                    <a href="#"-->
                                    <!--                                       class="js_add_cart_json btn btn-link d-inline-block border-end-0"-->
                                    <!--                                       aria-label="Remove one"-->
                                    <!--                                       title="Remove one">-->
                                    <!--                                        <i class="position-relative z-index-1 fa fa-minus"/>-->
                                    <!--                                    </a>-->
                                    <input type="text"
                                           class="js_quantity quantity form-control border-start-0 border-end-0"
                                           t-att-data-line-id="line.id"
                                           t-att-data-product-id="line.product_id.id"
                                           t-att-value="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty"/>
                                    <t t-if="line._get_shop_warning(clear=False)">
                                        <a href="#" class="btn btn-link">
                                            <i class='fa fa-warning text-warning'
                                               t-att-title="line._get_shop_warning()"
                                               role="img"
                                               aria-label="Warning"/>
                                        </a>
                                    </t>
                                    <!--                                    <a t-else=""-->
                                    <!--                                       href="#"-->
                                    <!--                                       class="js_add_cart_json d-inline-block float_left btn btn-link border-start-0"-->
                                    <!--                                       aria-label="Add one"-->
                                    <!--                                       title="Add one">-->
                                    <!--                                        <i class="fa fa-plus position-relative z-index-1"/>-->
                                    <!--                                    </a>-->
                                </t>
                                <t t-else="">
                                    <input type="hidden"
                                           class="js_quantity form-control quantity"
                                           t-att-data-line-id="line.id"
                                           t-att-data-product-id="line.product_id.id"
                                           t-att-value="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty"/>
                                </t>
                            </t>
                            <t t-else="">
                                <span class="w-100 text-muted" t-esc="int(line.product_uom_qty)"/>
                                <input type="hidden"
                                       class="js_quantity quantity form-control"
                                       t-att-data-line-id="line.id"
                                       t-att-data-product-id="line.product_id.id"
                                       t-att-value="line.product_uom_qty"/>
                            </t>
                        </div>
                        <div class="mb-0 h6 fw-bold text-end" name="website_sale_cart_line_price">
                            <t t-if="line.discount">
                                <del t-attf-class="#{'text-danger mr8'}"
                                     style="white-space: nowrap;"
                                     t-out="line._get_displayed_unit_price() * line.product_uom_qty"
                                     t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                            </t>
                            <t t-if="website.show_line_subtotals_tax_selection == 'tax_excluded'"
                               t-set='product_price'
                               t-value='line.price_subtotal'/>
                            <t t-else=""
                               t-set='product_price'
                               t-value='line.price_total'/>
                            <span t-out="product_price" style="white-space: nowrap;"
                                  t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}"/>
                            <small t-if="not line._is_not_sellable_line() and line.product_id.base_unit_price"
                                   class="cart_product_base_unit_price d-block text-muted"
                                   groups="website_sale.group_show_uom_price">
                                <t t-call='website_sale.base_unit_price'>
                                    <t t-set='product' t-value='line.product_id'/>
                                    <t t-set='combination_info'
                                       t-value="{'base_unit_price': product._get_base_unit_price(product_price/line.product_uom_qty)}"/>
                                </t>
                            </small>
                        </div>
                    </div>
                </t>
            </div>
        </div>
    </template>

    <template id="website_sale.product" name="Product" track="1">
        <!-- Qweb variable defining the class suffix for navbar items.
             Change accordingly to the derired visual result (eg. `primary`, `dark`...)-->
        <t t-set="navClass" t-valuef="light"/>

        <t t-cache="pricelist,product,fiscal_position">
            <!-- TODO drop _get_first_possible_combination here -->
            <t t-set="combination" t-value="product._get_first_possible_combination()"/>
            <t t-set="combination_info" t-value="product._get_combination_info(combination, add_qty=add_qty)"/>
            <t t-set="product_variant" t-value="product.env['product.product'].browse(combination_info['product_id'])"/>

            <t t-call="website.layout">
                <t t-set="additional_title" t-value="product.name"/>
                <div itemscope="itemscope" itemtype="http://schema.org/Product" id="wrap"
                     class="js_sale o_wsale_product_page">
                    <div class="oe_structure oe_empty oe_structure_not_nearest" id="oe_structure_website_sale_product_1"
                         data-editor-message="DROP BUILDING BLOCKS HERE TO MAKE THEM AVAILABLE ACROSS ALL PRODUCTS"/>
                    <section id="product_detail"
                             t-attf-class="container py-4 oe_website_sale #{'discount' if combination_info['has_discounted_price'] else ''}"
                             t-att-data-view-track="view_track and '1' or '0'"
                             t-att-data-product-tracking-info="'product_tracking_info' in combination_info and json.dumps(combination_info['product_tracking_info'])"
                    >
                        <div class="row align-items-center">
                            <div class="col-lg-6 d-flex align-items-center">
                                <div class="d-flex justify-content-between w-100">
                                    <t t-if="is_view_active('website_sale.search')" t-call="website_sale.search">
                                        <t t-set="search" t-value="False"/>
                                        <t t-set="_form_classes" t-valuef="mb-2 mb-lg-0"/>
                                        <t t-set="_classes" t-value="'me-sm-2'"/>
                                    </t>
                                    <t t-set="website_sale_pricelists"
                                       t-value="website.get_pricelist_available(show_visible=True)"/>
                                    <t t-set="hasPricelistDropdown"
                                       t-value="website_sale_pricelists and len(website_sale_pricelists)&gt;1"/>
                                    <t t-call="website_sale.pricelist_list">
                                        <t t-set="_classes" t-valuef="d-lg-inline ms-2"/>
                                    </t>
                                </div>
                            </div>
                            <div class="col-lg-6 d-flex align-items-center">
                                <ol class="breadcrumb p-0 mb-2 m-lg-0">
                                    <li class="breadcrumb-item o_not_editable">
                                        <a t-att-href="keep(category=0)">All Products</a>
                                    </li>
                                    <li t-nocache="The category does not have to be cached, as the product can be accessed via different paths."
                                        t-if="category" class="breadcrumb-item">
                                        <a t-att-href="keep('/shop/category/%s' % slug(category), category=0)"
                                           t-field="category.name"/>
                                    </li>
                                    <li class="breadcrumb-item active">
                                        <span t-field="product.name"/>
                                    </li>
                                </ol>
                            </div>
                        </div>
                        <div class="row" id="product_detail_main" data-name="Product Page"
                             t-att-data-image_width="website.product_page_image_width"
                             t-att-data-image_layout="website.product_page_image_layout">
                            <t t-set="image_cols" t-value="website._get_product_page_proportions()"/>
                            <div t-attf-class="col-lg-#{image_cols[0]} mt-lg-4 o_wsale_product_images position-relative"
                                 t-if="website.product_page_image_width != 'none'">
                                <t t-call="website_sale.shop_product_images"/>
                            </div>
                            <div t-attf-class="col-lg-#{image_cols[1]} mt-md-4" id="product_details">
                                <t t-set="base_url" t-value="product.get_base_url()"/>
                                <h1 itemprop="name" t-field="product.name">Product Name</h1>
                                <span itemprop="url" style="display:none;" t-esc="base_url + product.website_url"/>
                                <span itemprop="image" style="display:none;"
                                      t-esc="base_url + website.image_url(product, 'image_1920')"/>
                                <t t-if="is_view_active('website_sale.product_comment')">
                                    <a href="#o_product_page_reviews"
                                       class="o_product_page_reviews_link text-decoration-none">
                                        <t t-call="portal_rating.rating_widget_stars_static">
                                            <t t-set="rating_avg" t-value="product.rating_avg"/>
                                            <t t-set="trans_text_plural">%s reviews</t>
                                            <t t-set="trans_text_singular">%s review</t>
                                            <t t-set="rating_count"
                                               t-value="(trans_text_plural if product.rating_count > 1 else trans_text_singular) % product.rating_count"/>
                                        </t>
                                    </a>
                                </t>
                                <p t-field="product.description_sale" class="text-muted my-2"
                                   placeholder="A short description that will also appear on documents."/>
                                <div t-field="product.description_ecommerce" class="oe_structure"
                                     placeholder="A detailed, formatted description to promote your product on this page. Use '/' to discover more features."/>
                                <form t-if="product._is_add_to_cart_possible()" action="/shop/cart/update"
                                      method="POST">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"
                                           t-nocache="The csrf token must always be up to date."/>
                                    <div class="js_product js_main_product mb-3">
                                        <div>
                                            <t t-call="website_sale.product_price"/>
                                            <small t-if="combination_info['base_unit_price']"
                                                   class="ms-1 text-muted o_base_unit_price_wrapper d-none"
                                                   groups="website_sale.group_show_uom_price">
                                                <t t-call='website_sale.base_unit_price'/>
                                            </small>
                                        </div>
                                        <t t-placeholder="select">
                                            <input type="hidden" class="product_id" name="product_id"
                                                   t-att-value="product_variant.id"/>
                                            <input type="hidden" class="product_template_id" name="product_template_id"
                                                   t-att-value="product.id"/>
                                            <input t-if="product.public_categ_ids.ids" type="hidden"
                                                   class="product_category_id" name="product_category_id"
                                                   t-att-value="product.public_categ_ids.ids[0]"/>
                                            <t t-call="website_sale.variants">
                                                <t t-set="ul_class" t-valuef="flex-column"/>
                                                <t t-set="parent_combination" t-value="None"/>
                                            </t>
                                        </t>
                                        <p t-if="True" class="css_not_available_msg alert alert-warning">This
                                            combination does not exist.
                                        </p>
                                        <div id="o_wsale_cta_wrapper" class="d-flex flex-wrap align-items-center">
                                            <t t-set="hasQuantities" t-value="false"/>
                                            <t t-set="hasBuyNow" t-value="false"/>
                                            <t t-set="ctaSizeBig" t-value="not hasQuantities or not hasBuyNow"/>

                                            <div id="add_to_cart_wrap"
                                                 t-attf-class="{{'d-none' if combination_info['prevent_zero_price_sale'] else 'd-inline-flex'}} align-items-center mb-2 me-auto">
                                                <a data-animation-selector=".o_wsale_product_images" role="button"
                                                   id="add_to_cart"
                                                   t-attf-class="btn btn-primary js_check_product a-submit flex-grow-1"
                                                   href="#">
                                                    <i class="fa fa-shopping-cart me-2"/>
                                                    Add to cart
                                                </a>
                                            </div>
                                            <div id="product_option_block" class="d-flex flex-wrap w-100"/>
                                        </div>
                                        check in
                                        <input type="date" id="start_in" name="start_in"
                                               t-att-value="start_in"/>
                                        <br></br>
                                        check out
                                        <input type="date" id="start_out" name="start_out"
                                               t-att-value="start_out"/>

                                        <div id="contact_us_wrapper"
                                             t-attf-class="{{'d-flex' if combination_info['prevent_zero_price_sale'] else 'd-none'}} oe_structure oe_structure_solo #{_div_classes}">
                                            <section class="s_text_block" data-snippet="s_text_block" data-name="Text">
                                                <div class="container">
                                                    <a t-att-href="website.contact_us_button_url"
                                                       class="btn btn-primary btn_cta">Contact Us
                                                    </a>
                                                </div>
                                            </section>
                                        </div>
                                        <t t-if="is_view_active('website_sale.product_tags')"
                                           t-call="website_sale.product_tags">
                                            <t t-set="all_product_tags" t-value="product_variant.all_product_tag_ids"/>
                                        </t>
                                    </div>
                                </form>
                                <p t-elif="not product.active" class="alert alert-warning">This product is no longer
                                    available.
                                </p>
                                <p t-else="" class="alert alert-warning">This product has no valid combination.</p>
                                <div id="product_attributes_simple">
                                    <t t-set="single_value_attributes"
                                       t-value="product.valid_product_template_attribute_line_ids._prepare_single_value_for_display()"/>
                                    <table t-attf-class="table table-sm text-muted {{'' if single_value_attributes else 'd-none'}}">
                                        <t t-foreach="single_value_attributes" t-as="attribute">
                                            <tr>
                                                <td>
                                                    <span t-field="attribute.name"/>:
                                                    <t t-foreach="single_value_attributes[attribute]" t-as="ptal">
                                                        <span t-field="ptal.product_template_value_ids._only_active().name"/>
                                                        <t t-if="not ptal_last">,</t>
                                                    </t>
                                                </td>
                                            </tr>
                                        </t>
                                    </table>
                                </div>
                                <t t-set="product_documents"
                                   t-value="product.sudo().product_document_ids.filtered(lambda doc: doc.shown_on_product_page)"/>
                                <div id="product_documents" class="my-2" t-if="product_documents">
                                    <h5>Documents</h5>
                                    <t t-foreach="product_documents" t-as="document_sudo">
                                        <t t-set="attachment_sudo" t-value="document_sudo.ir_attachment_id"/>
                                        <t t-set="target"
                                           t-value="attachment_sudo.type == 'url' and '_blank' or '_self'"/>
                                        <t t-set="icon"
                                           t-value="attachment_sudo.type == 'url' and 'fa-link' or 'fa-download'"/>
                                        <div>
                                            <a t-att-href="'/shop/' + slug(product) + '/document/' + str(document_sudo.id)"
                                               t-att-target="target">
                                                <i t-att-class="'fa ' + icon"/>
                                                <t t-out="attachment_sudo.name"/>
                                            </a>
                                        </div>
                                    </t>
                                </div>
                                <div id="o_product_terms_and_share"
                                     class="d-flex justify-content-between flex-column flex-md-row align-items-md-end mb-3">
                                </div>
                            </div>
                        </div>
                    </section>
                    <div itemprop="description" t-field="product.website_description" class="oe_structure oe_empty mt16"
                         id="product_full_description"/>
                    <div class="oe_structure oe_empty oe_structure_not_nearest mt16"
                         id="oe_structure_website_sale_product_2"
                         data-editor-message="DROP BUILDING BLOCKS HERE TO MAKE THEM AVAILABLE ACROSS ALL PRODUCTS"/>
                </div>
            </t>
        </t>
    </template>

</odoo>
